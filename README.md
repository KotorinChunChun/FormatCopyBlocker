# FormatCopyBlocker - 書式コピペ禁止アドイン ～様式の破壊は絶対に許しません～

* License: The MIT license
* Copyright (c) 2022 [KotorinChunChun](https://twitter.com/KotorinChunChun)

## これは

Excel上で貼り付けをしたときに「絶対に値として貼り付けが起こる」ように、クリップボードを監視・テキスト化するアドインです。

このアドインを起動するだけで、色、条件付き書式、入力規則リストなどの あらゆる書式情報の破壊を防ぐ事が可能です！

詳しくは、以下のツイート参照
https://twitter.com/KotorinChunChun/status/1518943384840585216?s=20&t=x7iCDkJieuEFfKFFwGAqrg

## 特徴

「値として貼り付けを促す」のが簡単に実装できる方法として、 Application.OnKey でショートカットキーの Ctrl+V を上書きするというものがあります。しかしこの方法ではマウス操作による貼り付け操作に対処できません。

また、セルの値の変化を検知して発火するChangeイベント等と、元に戻す操作 Application.Undo を組み合わせる方法もあります。しかし、この方法を実現するにはロジックが非常に難解で、しかもイベントが多発するためExcelが非常に低速化します。

更にVBAから値を出力するという実装方法では、標準機能の「元に戻す」ログが消失するという厄介な副作用もあります。

本アドインでは、これらの問題を回避するために、「選択したセルが変化したときにクリップボードの内容から書式情報を抹しタブ区切りのプレーンテキストで上書きする」という手法で実装しています。副作用として、切り取り時のみ元に戻すログが消失する、コピー範囲を示す破線が消えるのでコピー状態が分かりづらい、書式情報をコピーしたくてもコピーできない。などがありますが、ギリギリ実用で許容できる範囲になっています。

また、本ロジックを破壊して欲しくないセル（特に入力規則が設定されたセル）のみで発火するようにしておけば、副作用も最小限に抑えることが可能で応用性が高いコードです。

## マジレス

値として貼り付けは、操作法さえ知っていれば、さほど面倒ではありません。

こんなアドインを作っている暇があったら、さっさと利用者を教育してください。

以下が作者の「値として貼り付け」のオススメ操作ランキングです。

- Ctrl + V → V
- 右クリック + V
- アプリケーションキー + V
- Shift + F10 → V
- Ctrl + Shift + V → V → Enter
- Alt → H → V → V
## アドイン導入について

binフォルダの中にあるxlamをダウンロードして、プロパティからブロックの解除をしてから、ダブルクリックで開くことで動作します。

詳しくは、過去のアドインの導入解説ページ参照
https://github.com/KotorinChunChun/ExcelFormulaEditor
